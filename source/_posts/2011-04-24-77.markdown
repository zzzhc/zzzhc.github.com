---
layout: post
title: 'solr faceted search'
date: 2011-4-24
wordpress_id: 77
permalink: /blogs/77
comments: true
---
从用户角度看，<a href="http://wiki.apache.org/solr/SolrFacetingOverview">faceted search</a>把搜索结果分入多个类别(一般还会显示各个类别下有多少结果)，并允许用户分类别查看。在电子商务类网站经常可以看到，如

<ul>
<li><a href="http://s.taobao.com/search?q=%C9%CF%CD%F8%B1%BE">淘宝</a>，显示全部分类</li>
<li><a href="http://www.amazon.cn/s/ref=nb_ss?url=search-alias%3Daps&amp;keywords=%E4%B8%8A%E7%BD%91%E6%9C%AC&amp;x=0&amp;y=0">卓越</a>，左侧</li>
<li><a href="http://search.360buy.com/Search?keyword=%C9%CF%CD%F8%B1%BE">京东商城</a>，顶部</li>
</ul>

FacetFields有两种，枚举型和分词型。枚举型适合类别比较少的场景，如卓越。分词型适合于类别很多，但每个document所属的类别较少的情况。Facet field不需要定义成stored,但需要是indexed. facet主要是用在drill-down到搜索结果的一个子集，实际查询是会生成一个对应类别的filter query.

实现原理，枚举型与分词型有些区别

<ul>
<li>枚举型，遍历field的所有terms, 得到各个term对应的document BitSet, 这个结果与query result作与</li>
<li>分词型，遍历搜索结果中的每个document, 从field cache里得到它对应的terms, 累加terms出现次数</li>
</ul>
