<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: misc | zzzhc's Blog]]></title>
  <link href="http://blog.zzzhc.com/blog/categories/misc/atom.xml" rel="self"/>
  <link href="http://blog.zzzhc.com/"/>
  <updated>2011-12-13T15:36:30+08:00</updated>
  <id>http://blog.zzzhc.com/</id>
  <author>
    <name><![CDATA[zzzhc]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[有道字典 chrome extension]]></title>
    <link href="http://blog.zzzhc.com/posts/2011/12/12/you-dao-zi-dian-httpjie-kou/"/>
    <updated>2011-12-12T11:17:00+08:00</updated>
    <id>http://blog.zzzhc.com/posts/2011/12/12/you-dao-zi-dian-httpjie-kou</id>
    <content type="html"><![CDATA[<p>有道字典的chrome extension会把鼠标下的词log到console里，debug的时候让人烦, 看了下code, 直接用的console.log, 发布的时候也没注释掉. 跑到~/Library/Application Support/Google/Chrome/Default/Extensions/nbndkplefmmhmcmfjanjaakhhkiegogd/1.0_0下把content.js,background.html里的console.log都注释掉，安静了。</p>

<p>大概看了下extension code, 发现两个有意思的地方：</p>

<ul>
<li>打包的时候连.svn目录都没放过</li>
</ul>


<p><code>
$ svn info
Path: .
URL: https://dev.corp.youdao.com/svn/outfox/products/desktop/incubator/mac/GetWordExtension/Chrome/extension
Repository Root: https://dev.corp.youdao.com/svn/outfox
Repository UUID: 36a6777f-fe3c-0410-890b-904d6044f29d
Revision: 285097
Node Kind: directory
Schedule: normal
Last Changed Author: huangdx
Last Changed Rev: 277738
Last Changed Date: 2011-09-13 14:00:17 +0800 (二, 13  9 2011)
</code></p>

<ul>
<li>取词的时候调用的是本机有道字典app提供的http接口</li>
</ul>


<p>```
//in background.html</p>

<pre><code> function SendResult(word, pos, type) {
     var s = new XMLHttpRequest;
     s.open("GET", "http://localhost:32445/getword?word=" + word + "&amp;pos=" + pos + "&amp;type=" + type, true);
     //console.log('sending...')
     s.send()
 };
</code></pre>

<p>```</p>

<p>用curl试了下，可以发送请求，但响应为空</p>

<p>```
$ curl -vv 'http://localhost:32445/getword?word=for%20suppliers&amp;pos=8&amp;type=0'
* About to connect() to localhost port 32445 (#0)
*   Trying ::1... Connection refused
*   Trying 127.0.0.1... connected
* Connected to localhost (127.0.0.1) port 32445 (#0)</p>

<blockquote><p>GET /getword?word=for%20suppliers&amp;pos=8&amp;type=0 HTTP/1.1
User-Agent: curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.21.4 OpenSSL/0.9.8r zlib/1.2.5
Host: localhost:32445
Accept: <em>/</em></p>

<ul>
<li>Empty reply from server</li>
<li>Connection #0 to host localhost left intact
curl: (52) Empty reply from server</li>
<li>Closing connection #0
```</li>
</ul>
</blockquote>

<p>word, pos, type这三个参数只要少一个有道字典就会crash</p>

<p>这次http request只是一个trigger, 有道字典会向dict.youdao.com发一个request:</p>

<p>```
$ curl -vv 'http://dict.youdao.com/fsearch?q=for%20suppliers&amp;pos=8&amp;keyfrom=mac.scrtrans.0&amp;id=E33EC7736AFDCABB184051CD3757CA73&amp;vendor=cidian.youdao.com&amp;client=macdict'
* About to connect() to dict.youdao.com port 80 (#0)
*   Trying 61.135.218.32... connected
* Connected to dict.youdao.com (61.135.218.32) port 80 (#0)</p>

<blockquote><p>GET /fsearch?q=for%20suppliers&amp;pos=8&amp;keyfrom=mac.scrtrans.0&amp;id=E33EC7736AFDCABB184051CD3757CA73&amp;vendor=cidian.youdao.com&amp;client=macdict HTTP/1.1
User-Agent: curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.21.4 OpenSSL/0.9.8r zlib/1.2.5
Host: dict.youdao.com
Accept: <em>/</em></p>

<p>&lt; HTTP/1.1 200 OK
&lt; Server: nginx
&lt; Date: Tue, 13 Dec 2011 07:10:55 GMT
&lt; Content-Type: text/xml; charset=utf-8
&lt; Connection: keep-alive
&lt; Cache-Control: private
&lt; Content-Language: en-US
&lt; Set-Cookie: OUTFOX_SEARCH_USER_ID=-447518408@123.117.56.163; domain=.youdao.com; expires=Thu, 05-Dec-2041 07:10:55 GMT
&lt; Set-Cookie: JSESSIONID=abcdjNBcCWPPK4igOq2qt; domain=youdao.com; path=/
&lt; Vary: Accept-Encoding
&lt; Content-Length: 1477
&lt;
&lt;?xml version="1.0" encoding="UTF-8"?></p></blockquote>

<p><yodaodict>
  <return-phrase>&lt;![CDATA[suppliers]]&gt;</return-phrase></p>

<pre><code>                        &lt;phonetic-symbol&gt;sə'plaiəz&lt;/phonetic-symbol&gt;
              &lt;dictcn-speach&gt;suppliers&lt;/dictcn-speach&gt;
                      &lt;custom-translation&gt;
    &lt;type&gt;ec&lt;/type&gt;
              &lt;translation&gt;&lt;content&gt;&lt;![CDATA[n. 供应商（supplier的复数）]]&gt;&lt;/content&gt;&lt;/translation&gt;
            &lt;/custom-translation&gt;

          &lt;yodao-web-dict&gt;
                &lt;web-translation&gt;
            &lt;key&gt;&lt;![CDATA[Suppliers]]&gt;&lt;/key&gt;
                      &lt;trans&gt;&lt;value&gt;&lt;![CDATA[供应商]]&gt;&lt;/value&gt;&lt;/trans&gt;
              &lt;trans&gt;&lt;value&gt;&lt;![CDATA[供货商]]&gt;&lt;/value&gt;&lt;/trans&gt;
              &lt;trans&gt;&lt;value&gt;&lt;![CDATA[数据库]]&gt;&lt;/value&gt;&lt;/trans&gt;
            &lt;/web-translation&gt;
          &lt;web-translation&gt;
            &lt;key&gt;&lt;![CDATA[Overview Suppliers]]&gt;&lt;/key&gt;
                      &lt;trans&gt;&lt;value&gt;&lt;![CDATA[概览]]&gt;&lt;/value&gt;&lt;/trans&gt;
              &lt;trans&gt;&lt;value&gt;&lt;![CDATA[供应商]]&gt;&lt;/value&gt;&lt;/trans&gt;
            &lt;/web-translation&gt;
          &lt;web-translation&gt;
            &lt;key&gt;&lt;![CDATA[select suppliers]]&gt;&lt;/key&gt;
                      &lt;trans&gt;&lt;value&gt;&lt;![CDATA[挑选供应商]]&gt;&lt;/value&gt;&lt;/trans&gt;
            &lt;/web-translation&gt;
        &lt;/yodao-web-dict&gt;

                         &lt;recommend&gt;&lt;![CDATA[supplier]]&gt;&lt;/recommend&gt;
                &lt;sexp&gt;0&lt;/sexp&gt;
</code></pre>

<p></yodaodict>
* Connection #0 to host dict.youdao.com left intact
* Closing connection #0
```</p>

<p>拿到结果后由有道字典显示一个提示窗口.</p>

<p>这种实现方式倒也算精巧, 其他app要用这个http接口也比较方便，只是32445端口连个http 200都不返回粗暴了点.</p>
]]></content>
  </entry>
  
</feed>
